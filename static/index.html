<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/beercss@3.7.8/dist/cdn/beer.min.css" rel="stylesheet" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/beercss@3.7.8/dist/cdn/beer.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/material-dynamic-colors@1.1.2/dist/cdn/material-dynamic-colors.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.23/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.2/lib/anime.min.js"></script>
    <title>Brook</title>

    <script>
        window.addEventListener("DOMContentLoaded", async (e) => {
            var app = {
                data() {
                    return {
                        user: {},
                        password: '',
                        settings: {},
                        origin: location.origin,
                        mobile: /Android|iPhone/i.test(navigator.userAgent)
                    };
                },
                async mounted() {
                    try {
                        await this.getsettings()
                        document.title = this.settings.site_name ? this.settings.site_name.v : ''
                        this.user.uuid = localStorage.getItem("uuid")
                        if (this.user.uuid) {
                            await this.getuser();
                        }
                    } catch (e) {
                        alert(`${e}`)
                    }
                    setTimeout(() => {
                        var textWrapper = document.querySelector('.ml9 .letters');
                        if (!textWrapper) return
                        textWrapper.innerHTML = textWrapper.textContent.replace(/\S/g, "<span class='letter'>$&</span>");
                        anime.timeline({loop: true})
                            .add({
                                targets: '.ml9 .letter',
                                scale: [0, 1],
                                duration: 1500,
                                elasticity: 600,
                                delay: (el, i) => 45 * (i + 1)
                            }).add({
                                targets: '.ml9',
                                opacity: 0,
                                duration: 1000,
                                easing: "easeOutExpo",
                                delay: 1000
                            });
                    }, 1000)
                },
                methods: {
                    async signup() {
                        try {
                            var res = await fetch("/signup", {
                                method: "POST",
                                body: JSON.stringify(this.user),
                            })
                            if (res.status != 200) {
                                throw (await res.text())
                                return
                            }
                            alert('ok')
                        } catch (e) {
                            alert(`${e}`)
                        }
                    },
                    async signin() {
                        try {
                            var res = await fetch("/signin", {
                                method: "POST",
                                body: JSON.stringify(this.user),
                            })
                            if (res.status != 200) {
                                throw (await res.text())
                                return
                            }
                            this.user = await res.json();
                            localStorage.setItem("uuid", this.user.uuid);
                        } catch (e) {
                            alert(`${e}`)
                        }
                    },
                    async getuser() {
                        try {
                            var res = await fetch("/getuser", {
                                method: "POST",
                                body: JSON.stringify(this.user),
                            })
                            if (res.status != 200) {
                                throw (await res.text())
                                return
                            }
                            this.user = await res.json();
                        } catch (e) {
                            alert(`${e}`)
                        }
                    },
                    async getsettings() {
                        try {
                            var res = await fetch("/getsomesettings")
                            if (res.status != 200) {
                                alert(await res.text())
                                return
                            }
                            (await res.json()).forEach(v => {
                                this.settings[v.k] = v;
                            });
                        } catch (e) {
                            alert(`${e}`)
                        }
                    },
                    async updatepassword() {
                        try {
                            var res = await fetch("/updatepassword", {
                                method: "POST",
                                body: JSON.stringify({...this.user, password: this.password}),
                            })
                            if (res.status != 200) {
                                throw (await res.text())
                                return
                            }
                            alert('ok')
                        } catch (e) {
                            alert(`${e}`)
                        }
                    },
                },
            };
            Vue.createApp(app).mount("body");
        });
    </script>
    <style>
        .ml9 {
            position: relative;
            font-weight: 200;
            font-size: 3em;
        }

        .ml9 .text-wrapper {
            position: relative;
            display: inline-block;
            padding-top: 0.2em;
            padding-right: 0.05em;
            padding-bottom: 0.1em;
            overflow: hidden;
        }

        .ml9 .letter {
            transform-origin: 50% 100%;
            display: inline-block;
            line-height: 1em;
        }
    </style>
</head>

<body style="margin:0;" class="dark">
    <header>
        <nav>
            <h5 class="max">{{settings.site_name ? settings.site_name.v : ''}}</h5>
        </nav>
    </header>
    <main v-if="!user.uuid && !mobile">
        <div class="grid no-space">
            <div class="s6" style="height: calc(100dvh - 64px);">
                <div style="height:30px;"></div>
                <div style="padding:60px 30px 0px 30px;">
                    <h1 class="ml9">
                        <span class="text-wrapper">
                            <span class="letters">{{settings.site_description ? settings.site_description.v : ''}}</span>
                        </span>
                    </h1>
                </div>
                <div style="height:30px;"></div>
                <div style="display: flex;flex-direction:row;justify-content:center;">
                    <a class="chip" style="color:white;border-color: white;">$3/100G/month</a>
                    <a class="chip" style="color:white;border-color: white;">$5/200G/month</a>
                    <a class="chip" style="color:white;border-color: white;">$10/500G/month</a>
                </div>
            </div>
            <div class="s6">
                <div style="height:90px;"></div>
                <div style="display:flex;flex-direction: row;justify-content:center">
                    <article class="secondary-container" style="display:flex;flex-direction:column;align-items: center; background-color:white !important;color:black !important">
                        <h5>Signin/Signup</h5>
                        <div style="height:10px;"></div>
                        <div class="field label border">
                            <input type="text" v-model="user.username">
                            <label>Username</label>
                        </div>
                        <div class="field label border">
                            <input type="text" v-model="user.password">
                            <label>Password</label>
                        </div>
                        <div style="display:flex;flex-direction:row;justify-content:center">
                            <button @click="signup" style="background-color:black !important;color:white !important">Signup</button>
                            <div style="width:30px;"></div>
                            <button @click="signin" style="background-color:black !important;color:white !important">Signin</button>
                        </div>
                    </article>
                </div>
            </div>
        </div>
    </main>
    <main v-if="!user.uuid && mobile">
        <div>
            <div style="height:30px;"></div>
            <div style="padding:0px 30px 0px 30px;">
                <h6 class="ml9">
                    <span class="text-wrapper">
                        <span class="letters">{{settings.site_description ? settings.site_description.v : ''}}</span>
                    </span>
                </h6>
            </div>
            <div style="height:30px;"></div>
            <div style="display: flex;flex-direction:row;justify-content:center;">
                <a class="chip" style="color:white;border-color: white;">$3/100G/month</a>
                <a class="chip" style="color:white;border-color: white;">$5/200G/month</a>
                <a class="chip" style="color:white;border-color: white;">$10/500G/month</a>
            </div>
        </div>
        <div>
            <div style="height:50px;"></div>
            <div style="display:flex;flex-direction: row;justify-content:center">
                <article class="secondary-container" style="display:flex;flex-direction:column;align-items: center; background-color:white !important;color:black !important">
                    <h5>Signin/Signup</h5>
                    <div style="height:10px;"></div>
                    <div class="field label border">
                        <input type="text" v-model="user.username">
                        <label>Username</label>
                    </div>
                    <div class="field label border">
                        <input type="text" v-model="user.password">
                        <label>Password</label>
                    </div>
                    <div style="display:flex;flex-direction:row;justify-content:center">
                        <button @click="signup" style="background-color:black !important;color:white !important">Signup</button>
                        <div style="width:30px;"></div>
                        <button @click="signin" style="background-color:black !important;color:white !important">Signin</button>
                    </div>
                </article>
            </div>
        </div>
    </main>
    <main class="responsive" v-if="user.uuid">
        <div style="height:30px;"></div>
        <div style="display: flex;flex-direction:row;justify-content:center;">
            <a class="chip" style="color:white;border-color: white;">$3/100G/month</a>
            <a class="chip" style="color:white;border-color: white;">$5/200G/month</a>
            <a class="chip" style="color:white;border-color: white;">$10/500G/month</a>
        </div>
        <div style="height:30px;"></div>
        <div style="display:flex;flex-direction: column;align-items:center;padding:0px 10px;">
            <article class="secondary-container" style="background-color:white !important;color:black !important">
                <h5>{{user.username}}</h5>
                <div style="height:10px;"></div>
                <div>{{new Date(user.expired_at*1000).toLocaleString()}}</div>
                <div style="height:10px;"></div>
                <div>{{user.traffic_now}}/{{user.traffic_max}}M</div>
                <div style="height:10px;"></div>
                <div style="text-align: center;word-break: break-all;">{{origin+'/import?uuid='+user.uuid}}</div>
            </article>
        </div>
        <div style="height:30px;"></div>
        <div style="display:flex;flex-direction: row;justify-content:center">
            <details>
                <summary class="none">
                    <article class="round primary no-elevate">
                        <nav>
                            <div class="max">Update Password</div>
                            <i>expand_more</i>
                        </nav>
                    </article>
                </summary>
                <article class="secondary-container">
                    <div style="height:10px;"></div>
                    <div class="field label border">
                        <input type="text" v-model="password">
                        <label>New Password</label>
                    </div>
                    <div style="display: flex;justify-content:center;">
                        <button @click="updatepassword">Update</button>
                    </div>
                </article>
            </details>
        </div>
        <div style="height:30px;"></div>
        <div style="text-align: center;color:white;">Download Brook client from <a href="https://brook.app" target="_blank">https://brook.app</a> and import your link. Note that sharing your link is equivalent to sharing your username and password.</div>
        <div style="text-align: center;color:white;">If you have any questions, the only way to contact us is: {{settings.contact ? settings.contact.v : ''}}</div>
    </main>
</body>

</html>
